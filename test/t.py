class Solution:
    def hasValidPath(self, grid):
        dic = {
            1: [1,0,1,0],
            2: [0,1,0,1],
            3: [1,0,0,1],
            4: [0,0,1,1],
            5: [1,1,0,0],
            6: [0,1,1,0]
        }
        rl = len(grid)
        cl = len(grid[0])
        ngrid = []
        for r in range(rl):
            c = []
            for cc in range(cl):
                c.append([])
            ngrid.append(c)
        for i,row in enumerate(grid):
            for j,val in enumerate(row):
                ngrid[i][j] = dic[val][:]
        v = grid[0][0]
        if v in [1,3,5]:
            ngrid[0][0][0] = 0
            return self.get(ngrid,rl,cl)
        elif v in [2,6]:
            ngrid[0][0][1] = 0
            return self.get(ngrid,rl,cl)
        else:
            ngrid[0][0][2] = 0
            re1 = self.get(ngrid,rl,cl)
            if re1:
                return True
            ngrid = []
            for r in range(rl):
                c = []
                for cc in range(cl):
                    c.append([])
                ngrid.append(c)
            for i,row in enumerate(grid):
                for j,val in enumerate(row):
                    ngrid[i][j] = dic[val][:]
            ngrid[0][0][3] = 0
            return self.get(ngrid,rl,cl)


    def get(self, ngrid,rl, cl):
        result = False
        i = 0
        j = 0
        while i < rl and j < cl:
            if i == rl-1 and j == cl-1:
                return True
            ni = i
            nj = j
            next = ngrid[i][j].index(1)
            if next == 0:
                nj -= 1
            elif next == 1:
                ni -= 1
            elif next == 2:
                nj += 1
            elif next == 3:
                ni += 1
            np = (next + 2) % 4
            if ni<0 or ni>=rl or nj <0 or nj>=cl:
                break
            if ngrid[ni][nj][np] != 1:
                break
            ngrid[ni][nj][np] = 0
            i = ni
            j = nj
        return result



s = Solution()
print(s.hasValidPath([[4,4,3,4,1,2,2,6,3,1,6,4,5,5,4,6,5,5,3,6,3,1,2,4,5,6,6,5,5,4,4,3,3,6,1,4,3,2,2,6,6,5,4,6,2,1],[6,4,6,2,4,2,6,6,2,4,6,6,2,6,4,2,4,6,1,4,6,6,6,1,1,2,3,6,3,3,2,2,5,2,1,4,6,3,4,5,3,1,1,4,3,4],[2,5,6,1,6,3,4,5,5,1,4,5,4,3,2,3,6,5,3,2,5,5,4,4,2,1,4,5,2,4,5,3,1,1,4,4,5,6,2,4,3,4,3,6,5,5],[4,4,1,5,3,6,6,2,4,2,2,6,1,6,1,6,2,2,6,5,1,5,4,3,4,1,1,5,2,2,5,1,3,6,5,1,6,4,6,3,5,6,4,2,4,2],[3,1,6,6,3,1,6,5,1,4,5,6,2,1,1,6,2,5,6,1,4,2,2,6,5,1,2,3,6,6,5,3,4,1,2,5,6,2,4,1,4,1,3,5,1,3],[6,4,1,1,3,3,1,2,4,3,6,2,4,4,6,5,4,1,6,3,2,5,5,3,4,4,4,1,3,4,2,2,3,3,5,6,2,6,3,3,2,5,3,4,5,2],[1,2,1,4,5,2,1,1,1,1,4,4,2,6,1,2,1,6,1,6,1,6,5,3,2,1,3,4,5,5,1,4,3,5,6,2,5,2,1,6,6,4,4,3,2,2],[6,6,4,2,3,4,1,2,5,3,5,1,6,4,6,4,1,1,1,5,5,5,1,6,1,2,3,5,6,6,5,1,4,1,1,5,3,6,5,1,3,3,5,4,2,5],[4,3,1,2,4,3,3,6,1,1,3,3,6,3,6,4,3,3,6,4,3,3,1,4,3,4,6,1,6,4,5,6,1,6,4,4,3,6,2,1,1,6,2,3,4,1],[6,2,4,5,4,2,2,2,6,4,4,1,6,3,5,1,3,4,3,2,6,1,5,1,5,5,4,6,2,4,2,6,5,1,6,1,5,1,3,1,5,4,4,5,6,3],[3,4,5,3,1,3,2,1,3,5,2,2,4,1,6,4,2,6,4,6,4,2,6,2,4,4,2,4,6,4,3,2,4,1,3,1,6,4,2,2,3,4,4,4,4,2],[2,1,5,1,4,1,2,5,4,3,4,3,3,1,4,4,6,4,1,6,5,6,1,6,5,4,6,2,1,5,1,4,6,6,6,4,6,4,4,2,1,4,1,4,3,5],[4,2,1,5,5,2,3,5,2,3,4,2,3,3,4,5,5,2,5,4,5,4,4,4,4,4,4,1,3,1,5,1,5,3,1,6,1,1,1,2,4,6,3,4,4,1],[3,5,6,4,1,5,5,6,3,2,5,1,3,5,2,5,3,2,4,2,1,1,5,1,1,4,6,2,5,6,6,6,1,6,4,4,3,5,5,6,4,1,2,4,3,3],[4,6,4,1,3,2,4,6,5,2,5,5,2,5,3,4,2,4,3,6,6,3,6,6,5,4,5,1,1,1,4,6,6,1,2,2,4,2,2,5,1,3,5,5,2,1],[6,3,3,2,3,6,6,5,6,1,3,3,6,1,5,6,2,2,1,4,6,2,3,4,4,2,4,6,3,5,3,1,3,2,2,3,3,6,5,2,4,6,5,4,1,4],[4,5,2,2,1,1,6,5,3,4,6,1,5,3,3,1,1,1,5,4,4,5,4,6,1,5,3,5,2,1,4,4,5,3,5,2,6,1,3,2,2,2,3,4,3,6],[1,2,4,1,6,3,1,3,4,3,5,6,6,5,2,4,5,3,1,1,5,6,2,3,3,1,5,2,5,1,3,4,1,3,4,5,6,3,3,4,2,5,4,6,1,4],[4,3,5,2,1,4,1,1,5,3,2,2,2,1,1,4,3,4,2,1,6,6,6,1,3,4,5,4,3,3,2,2,6,5,4,4,3,6,2,6,2,4,1,4,2,3],[3,2,3,1,6,6,6,4,1,2,6,3,3,5,2,3,6,1,3,6,4,1,3,4,1,4,3,5,2,1,3,1,6,6,2,6,3,6,5,6,2,4,6,5,5,2],[6,4,2,4,2,2,3,3,5,2,2,1,3,1,3,1,2,5,5,6,4,2,2,2,3,5,4,1,5,2,4,2,4,3,4,2,6,2,5,3,3,6,4,2,3,2],[4,1,3,6,1,4,6,5,3,4,6,5,1,4,5,5,4,2,2,1,6,3,3,4,3,4,5,2,4,4,4,4,4,2,6,3,2,4,1,1,4,4,6,4,2,3],[2,6,3,5,5,1,3,6,2,2,3,1,4,1,2,6,4,3,6,2,5,2,4,5,2,5,4,5,6,2,3,3,5,6,3,3,3,5,1,1,5,6,6,1,4,3],[3,5,2,4,3,6,1,3,6,6,6,2,4,1,6,5,4,6,6,2,1,4,1,5,6,4,6,6,2,2,4,3,6,3,3,1,3,5,2,1,5,6,1,2,1,1],[2,3,4,3,2,1,1,2,4,5,2,5,3,3,1,2,6,4,6,5,4,6,6,3,3,2,1,1,1,4,5,6,2,5,1,2,6,6,6,3,2,4,5,1,6,5],[1,5,4,1,5,5,2,5,6,2,3,4,4,3,2,1,3,2,4,1,2,3,6,2,3,6,5,3,5,5,6,1,5,5,2,3,1,3,2,2,6,6,1,4,1,2],[3,6,5,3,5,4,2,6,4,3,6,3,1,5,2,5,5,6,3,1,4,6,2,1,3,1,2,1,1,1,4,3,4,3,5,5,2,6,6,3,1,1,3,3,3,2],[2,5,4,3,2,4,2,1,3,1,2,3,2,1,1,2,1,3,5,4,6,5,5,3,1,3,1,4,3,4,2,2,1,5,3,5,3,3,6,4,6,4,2,3,2,5],[5,6,6,3,6,1,5,5,3,1,2,2,5,6,4,5,2,6,2,1,1,2,6,1,3,6,2,3,1,4,4,1,1,4,6,3,2,2,5,1,3,4,2,3,6,5],[2,5,6,5,5,1,1,4,1,4,6,3,4,2,1,6,5,2,3,3,1,3,2,2,5,6,4,2,5,4,6,6,3,6,1,1,5,2,1,6,2,3,4,6,5,6],[1,6,4,4,5,2,1,2,5,3,6,1,1,6,2,6,1,1,6,2,3,4,6,3,2,3,4,5,2,1,3,2,1,3,4,4,2,5,5,3,4,2,3,3,6,2],[3,2,5,4,4,4,2,4,6,4,5,4,5,2,1,1,4,5,2,5,5,3,5,5,5,2,6,3,6,1,1,1,5,3,6,1,6,5,5,3,6,5,4,2,1,1],[1,1,1,3,6,1,3,5,4,2,2,4,6,5,3,5,6,1,6,2,6,3,1,6,1,6,3,1,5,4,1,1,4,4,4,1,1,3,4,3,5,2,3,5,4,4],[2,6,4,2,3,3,4,6,6,6,2,4,2,3,4,1,1,4,1,3,4,5,5,3,6,1,4,1,6,2,1,4,6,5,2,3,1,6,4,6,1,4,4,6,5,3],[2,4,5,2,5,1,6,6,6,1,6,3,3,6,2,1,6,2,2,4,4,3,2,1,3,1,4,1,5,5,6,6,2,4,6,2,3,5,1,3,5,1,2,5,1,6],[2,1,1,1,6,3,5,6,2,2,4,6,1,3,2,3,6,6,2,5,5,2,1,1,2,4,4,4,3,2,5,2,6,6,4,6,3,3,5,4,4,3,1,5,1,1],[1,5,4,4,3,1,4,1,2,1,1,6,1,6,2,4,3,2,3,1,6,4,1,5,2,2,2,2,5,5,4,4,2,6,5,5,1,6,1,3,1,5,4,6,3,4],[2,4,5,1,3,3,3,3,4,5,6,4,1,5,5,1,6,3,2,3,5,5,3,1,1,6,1,4,5,4,1,1,4,5,3,5,5,5,2,5,5,2,1,5,5,3],[2,1,1,1,6,3,4,2,3,2,5,3,5,5,6,3,3,1,3,5,3,5,5,3,6,5,3,5,5,1,6,2,2,3,3,6,1,1,4,2,3,6,6,2,2,4],[1,4,5,2,5,5,2,4,5,3,3,5,2,4,5,6,6,1,6,4,3,4,1,2,4,4,6,3,2,3,5,1,1,2,5,1,5,4,4,4,4,3,2,4,5,2],[2,4,5,4,6,5,5,4,3,6,3,6,1,5,5,2,3,2,6,1,5,4,4,5,4,6,3,1,2,4,3,2,1,3,6,6,2,1,3,6,5,1,1,1,1,5],[6,1,3,1,3,6,1,3,3,6,3,3,5,5,2,5,1,2,4,5,4,4,2,6,4,5,4,3,6,6,2,4,3,5,4,3,2,4,6,5,3,2,3,6,5,5],[3,3,6,2,1,6,1,3,2,3,1,4,2,5,6,3,6,2,6,5,6,4,5,5,3,4,4,3,4,5,3,4,2,5,2,2,4,4,5,2,4,4,6,6,1,5],[6,4,2,4,4,6,4,2,2,3,4,3,4,1,5,1,2,2,4,4,6,2,4,6,1,2,3,5,1,4,3,2,2,3,3,5,3,3,5,4,4,1,2,3,6,2],[5,2,6,5,4,3,5,4,6,2,2,6,1,2,6,2,5,3,5,3,4,3,5,2,2,4,5,3,5,6,4,1,6,1,3,3,4,1,5,1,1,4,6,3,3,3],[4,1,3,4,6,3,6,2,6,1,5,4,4,5,2,5,2,2,6,4,1,2,4,5,6,5,3,2,6,5,1,5,3,2,2,4,6,4,6,3,1,6,1,6,2,5],[2,4,1,4,2,6,3,4,2,2,3,2,2,5,2,4,1,6,2,2,6,1,3,4,5,2,6,2,1,1,1,5,2,1,5,1,2,3,3,5,6,1,3,3,1,4],[2,6,4,2,2,6,3,2,5,2,4,3,4,2,4,2,6,6,1,1,4,5,2,1,4,6,4,1,6,6,6,2,4,4,2,3,6,2,3,4,6,3,1,4,2,1]]))